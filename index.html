<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no'>
  <meta name='mobile-web-app-capable' content='yes'>
  <meta name='apple-mobile-web-app-capable' content='yes'>
  <link rel='icon' type='image/png' sizes='32x32' href='favicon-32x32.png'>
  <link rel='icon' type='image/png' sizes='96x96' href='favicon-96x96.png'>
  <link rel='stylesheet' href='css/common.css'>
  <title>Immersive VR Session</title>
  <style>
    body { margin: 0; }
    canvas { display: block; }
    #parentDiv { width: 100%; height: 100vh; }
    .xr-button {
      position: absolute;
      bottom: 20px;
      left: 20px;
      padding: 10px 20px;
      background-color: #0078d7;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <details open>
      <summary>Immersive VR Session</summary>
      <p>
        This sample demonstrates how to use an 'immersive-vr' XRSession to
        present a simple WebGL scene to an XR device. The scene is not
        rendered to the page.
        <a class="back" href="./">Back</a>
      </p>
    </details>
  </header>
  <div id="parentDiv"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="ringring1test1.js"></script>
  <script type="module">
    import {WebXRButton} from './js/util/webxr-button.js';
    import {Scene} from './js/render/scenes/scene.js';
    import {Renderer, createWebGLContext} from './js/render/core/renderer.js';
    import {Gltf2Node} from './js/render/nodes/gltf2.js';
    import {SkyboxNode} from './js/render/nodes/skybox.js';
    import {QueryArgs} from './js/util/query-args.js';

    // If requested, use the polyfill to provide support for mobile devices
    // and devices which only support WebVR.
    import WebXRPolyfill from './js/third-party/webxr-polyfill/build/webxr-polyfill.module.js';
    if (QueryArgs.getBool('usePolyfill', true)) {
      let polyfill = new WebXRPolyfill();
    }

    // XR globals.
    let xrButton = null;
    let xrRefSpace = null;

    // WebGL scene globals.
    let gl = null;
    let renderer = null;
    let scene = new Scene();
    scene.addNode(new Gltf2Node({url: 'media/gltf/space/space.gltf'}));
    scene.addNode(new SkyboxNode({url: 'media/textures/milky-way-4k.png'}));

    // Checks to see if WebXR is available and, if so, queries a list of
    // XRDevices that are connected to the system.
    function initXR() {
      // Adds a helper button to the page that indicates if any XRDevices are
      // available and let's the user pick between them if there's multiple.
      xrButton = new WebXRButton({
        onRequestSession: onRequestSession,
        onEndSession: onEndSession
      });
      document.body.appendChild(xrButton.domElement);
    }

    // Handle window resize
    function onWindowResize() {
      const width = parentDiv.clientWidth;
      const height = parentDiv.clientHeight;

      // Update camera
      camera.aspect = width / height;
      camera.updateProjectionMatrix();

      // Update renderer and composer
      renderer.setSize(width, height);
      composer.setSize(width, height);

      // Update post-processing passes
      bloomPass.resolution.set(width, height);
      smaaPass.setSize(width, height);
    }

    // Add event listeners
    window.addEventListener('resize', onWindowResize);
    const resizeObserver = new ResizeObserver(onWindowResize);
    resizeObserver.observe(parentDiv);

    // Start animation
    animate();

    // Start the XR application.
    initXR();
  </script>
</body>
</html>
